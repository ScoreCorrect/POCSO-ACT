<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Quiz Portal</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="questions.js"></script>
    <style>
        :root { --primary: #2563eb; --success: #22c55e; --danger: #ef4444; --warning: #f59e0b; --gray: #e2e8f0; --dark: #0f172a; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; background: #f8fafc; color: var(--dark); -webkit-tap-highlight-color: transparent; position: relative; min-height: 100vh; overflow-x: hidden; }

        /* Header */
        .header { 
            display: flex; justify-content: space-between; align-items: center;
            background: white; padding: 12px 16px; border-bottom: 1px solid var(--gray);
            position: sticky; top: 0; z-index: 100; height: 60px; box-sizing: border-box;
        }
        .quiz-title { font-weight: 800; font-size: 1rem; color: var(--primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 60%; }
        .timer { font-family: 'Courier New', monospace; font-weight: bold; color: var(--danger); font-size: 1.2rem; }

        /* Navigation Drawer */
        #nav-drawer {
            position: fixed; top: 0; right: -285px; width: 280px; height: 100%;
            background: white; box-shadow: -5px 0 15px rgba(0,0,0,0.1);
            z-index: 1001; transition: transform 0.3s cubic-bezier(0, 0, 0.2, 1);
            display: flex; flex-direction: column;
        }
        #nav-drawer.open { transform: translateX(-285px); }
        .drawer-header { padding: 20px; border-bottom: 1px solid var(--gray); }
        .drawer-content { flex: 1; overflow-y: auto; padding: 20px; -webkit-overflow-scrolling: touch; }

        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; z-index: 1000; }

        .nav-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin-bottom: 20px; }
        .nav-dot { 
            aspect-ratio: 1/1; border: 1px solid #cbd5e1; border-radius: 6px;
            display: flex; align-items: center; justify-content: center; font-size: 0.85rem;
            background: white; cursor: pointer; font-weight: 500;
        }
        .nav-dot.attempted { background: var(--primary); color: white; border-color: var(--primary); }
        .nav-dot.current { border: 2px solid black; background: #f1f5f9; }

        /* Quiz UI */
        .container { padding: 16px; max-width: 600px; margin: auto; position: relative; z-index: 10; }
        .question-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border: 1px solid var(--gray); }
        .option-item { padding: 14px; margin: 10px 0; border: 2px solid var(--gray); border-radius: 10px; display: flex; align-items: center; cursor: pointer; transition: 0.1s; }
        .option-item input { width: 20px; height: 20px; margin-right: 12px; flex-shrink: 0; }
        
        /* Controls */
        .controls { display: flex; justify-content: space-between; gap: 10px; margin-top: 25px; }
        button { border: none; border-radius: 8px; font-weight: 700; font-size: 0.95rem; cursor: pointer; }
        .btn-prev { background: #cbd5e1; color: var(--dark); flex: 1; padding: 15px; }
        .btn-next { background: var(--primary); color: white; flex: 1; padding: 15px; }
        .btn-menu { background: #f1f5f9; color: var(--dark); width: 44px; height: 44px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }

        /* Screens */
        #login-screen, #quiz-screen, #final-screen, #review-screen { display: none; }
        .active { display: block !important; }
        
        #final-screen { text-align: center; padding-top: 10vh; }
        .score-display { font-size: 2.5rem; font-weight: 800; color: var(--primary); margin: 20px 0; }

        /* Review Section Styles */
        .review-card { background: white; padding: 15px; margin-bottom: 15px; border-radius: 8px; border: 1px solid var(--gray); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .review-option { padding: 10px; border: 1px solid var(--gray); margin: 5px 0; border-radius: 6px; color: #64748b; font-size: 0.9rem; }
        
        /* Review Colors */
        .review-correct { border: 2px solid var(--success); background: #dcfce7; color: var(--success); font-weight: bold; }
        .review-wrong { border: 2px solid var(--danger); background: #fee2e2; color: var(--danger); font-weight: bold; }
        
        .q-header-review { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
        .q-text-review { font-weight: bold; display: block; flex: 1; margin-right: 10px; }
        .status-badge { font-size: 0.75rem; padding: 4px 8px; border-radius: 4px; font-weight: bold; white-space: nowrap; }

        .watermark-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            z-index: 0;
            pointer-events: none;
            width: 100%;
            text-align: center;
        }
        .watermark-text {
            font-size: 12vw;
            font-weight: 900;
            color: rgba(0, 0, 0, 0.04);
            text-transform: uppercase;
            white-space: nowrap;
            user-select: none;
        }
    </style>
</head>
<body>

    <div class="watermark-container">
        <div class="watermark-text">ScoreCorrectPSC</div>
    </div>

    <div class="overlay" id="overlay" onclick="toggleMenu()"></div>

    <div id="nav-drawer">
        <div class="drawer-header">
            <h3 style="margin:0">Question Status</h3>
            <small>Tap a number to jump</small>
        </div>
        <div class="drawer-content"><div class="nav-grid" id="nav-grid"></div></div>
        <div style="padding: 15px; border-top: 1px solid var(--gray);">
            <button onclick="toggleMenu()" style="background: var(--dark); color: white; width: 100%; padding: 12px;">Back to Question</button>
        </div>
    </div>

    <div id="login-screen" class="active container">
        <div class="question-card" style="margin-top: 50px; text-align: center;">
            <h1 style="color:var(--primary); margin-bottom: 8px;">POCSO ACT</h1>
            <p style="color: #64748b;">Enter your full name to begin</p>
            <input type="text" id="userName" placeholder="Type your name here..." style="width:100%; padding:15px; margin:20px 0; border:2px solid var(--gray); border-radius:8px; font-size: 1rem; box-sizing:border-box;">
            <button onclick="startQuiz()" class="btn-next" style="width:100%">Start Quiz Now</button>
        </div>
    </div>

    <div id="quiz-screen">
        <div class="header">
            <span class="quiz-title">POCSO ACT</span>
            <div style="display: flex; align-items: center; gap: 8px;">
                <span class="timer" id="timer">30:00</span>
                <button class="btn-menu" onclick="toggleMenu()">‚ò∞</button>
            </div>
        </div>
        <div class="container">
            <div class="question-card">
                <span id="q-counter" style="color: var(--primary); font-weight: bold; font-size: 0.8rem;">QUESTION 1</span>
                <h3 id="q-text" style="margin-top: 10px; line-height: 1.4;"></h3>
                <div id="options-container"></div>
                <div class="controls">
                    <button id="prevBtn" class="btn-prev" onclick="changeQuestion(-1)">Previous</button>
                    <button id="nextBtn" class="btn-next" onclick="changeQuestion(1)">Next Question</button>
                    <button id="submitBtn" class="btn-next" style="background:var(--success); display:none;" onclick="finishQuiz()">Submit Final Result</button>
                </div>
            </div>
        </div>
    </div>

    <div id="final-screen" class="container">
        <div style="font-size: 4rem; margin-bottom: 10px;">üèÜ</div>
        <div id="final-msg-container"></div>
    </div>

    <div id="review-screen" class="container">
        <h2 style="text-align: center; color: var(--primary); margin-top: 10px;">Your Responses</h2>
        <div style="text-align: center; margin-bottom: 15px; font-size: 0.8rem; display: flex; flex-wrap: wrap; justify-content: center; gap: 10px;">
            <span style="color:var(--success); font-weight:bold;">‚úî Correct</span>
            <span style="color:var(--danger); font-weight:bold;">‚úñ Wrong</span>
            <span style="color:var(--warning); font-weight:bold;">‚ö† Unattempted</span>
        </div>
        <div id="review-list"></div>
        <div style="margin-top: 20px;">
            <button class="btn-prev" style="width:100%" onclick="location.reload()">Close / Exit</button>
        </div>
    </div>

    <script>
        let currentIdx = 0;
        let userAnswers = new Array(quizQuestions.length).fill(null);
        let timeLeft = 30 * 60;
        let timerInterval;

        const FORM_ID = "1FAIpQLSdCkXL5LBwnm_n74ClLFsC4k4QVWJXrm7CfzzkhKmWe_KIKyg"; 
        const ENTRY_NAME = "entry.1501316275";
        const ENTRY_SCORE = "entry.1274011120";
        const ENTRY_TIME = "entry.601190537";

        // EDIT THIS VARIABLE TO TOGGLE MULTIPLE ENTRIES
        const ALLOW_MULTIPLE_ENTRIES = true;

        window.onload = function() {
            const savedData = localStorage.getItem('quiz_progress');
            if(savedData) {
                const data = JSON.parse(savedData);
                // CUSTOM MALAYALAM RESUME DIALOGUE
                if(confirm("Quiz ‡µª‡µç‡¥±‡µÜ ‡¥§‡µÅ‡¥ü‡µº‡¥ö‡µç‡¥ö ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡¥£‡µã ‡¥Ö‡¥§‡µã ‡¥Ü‡¥¶‡µç‡¥Ø‡¥Ç ‡¥Æ‡µÅ‡¥§‡µΩ ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡¥æ‡¥£‡µã üòä \n\n OK = ‡¥¨‡¥æ‡¥ï‡µç‡¥ï‡¥ø ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡¥æ‡¥Ç ü§ù \n Cancel = ‡¥Ü‡¥¶‡µç‡¥Ø‡¥Ç ‡¥Æ‡µÅ‡¥§‡µΩ ü§ó")) {
                    document.getElementById('userName').value = data.name;
                    userAnswers = data.answers;
                    timeLeft = data.time;
                    currentIdx = data.idx;
                    document.getElementById('login-screen').classList.remove('active');
                    document.getElementById('quiz-screen').classList.add('active');
                    loadQuestion();
                    startTimer();
                } else {
                    localStorage.removeItem('quiz_progress');
                }
            }
        }

        function saveProgress() {
            const name = document.getElementById('userName').value;
            const data = { name: name, answers: userAnswers, time: timeLeft, idx: currentIdx };
            localStorage.setItem('quiz_progress', JSON.stringify(data));
        }

        function toggleMenu() {
            const drawer = document.getElementById('nav-drawer');
            const overlay = document.getElementById('overlay');
            if (drawer.classList.contains('open')) {
                drawer.classList.remove('open');
                overlay.style.display = 'none';
            } else {
                renderNav();
                drawer.classList.add('open');
                overlay.style.display = 'block';
            }
        }

        function startQuiz() {
            const name = document.getElementById('userName').value.trim();
            if(!name) return alert("Please enter your name");

            // 24HR TOGGLE CHECK WITH CUSTOM MALAYALAM MESSAGE
            if (!ALLOW_MULTIPLE_ENTRIES) {
                if (localStorage.getItem('quiz_last_submitted')) {
                    return alert("‡¥±‡¥æ‡¥ô‡µç‡¥ï‡µç ‡¥≤‡¥ø‡¥∏‡µç‡¥±‡µç‡¥±‡µç ‡¥â‡¥£‡µç‡¥ü‡¥æ‡¥ï‡µç‡¥ï‡¥æ‡µª ‡¥â‡¥≥‡µç‡¥≥‡¥§‡¥ø‡¥®‡¥æ‡µΩ ‡¥í‡¥∞‡¥æ‡µæ ‡¥í‡¥∞‡µÅ ‡¥™‡µç‡¥∞‡¥æ‡¥µ‡¥∂‡µç‡¥Ø‡¥Ç ‡¥Æ‡¥æ‡¥§‡µç‡¥∞‡¥Æ‡µá ‡¥Ö‡¥±‡µç‡¥±‡µª‡¥°‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡¥æ‡µª ‡¥™‡¥æ‡¥ü‡µÅ‡¥≥‡µç‡¥≥‡µÇ, 24hr ‡¥ï‡¥¥‡¥ø‡¥û‡µç‡¥û‡¥æ‡µΩ ‡¥é‡¥§‡µç‡¥∞ ‡¥™‡µç‡¥∞‡¥æ‡¥µ‡¥∂‡µç‡¥Ø‡¥Ç ‡¥µ‡µá‡¥£‡¥Æ‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡¥≤‡µÅ‡¥Ç ‡¥Ö‡¥±‡µç‡¥±‡µª‡¥°‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥§‡µç ‡¥®‡µã‡¥ï‡µç‡¥ï‡¥æ‡¥Ç ü•∞, Please Wait.");
                }
            }

            document.getElementById('login-screen').classList.remove('active');
            document.getElementById('quiz-screen').classList.add('active');
            loadQuestion();
            startTimer();
            saveProgress();
        }

        function startTimer() {
            if(timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                let mins = Math.floor(timeLeft / 60);
                let secs = timeLeft % 60;
                document.getElementById('timer').innerText = `${mins}:${secs < 10 ? '0' : ''}${secs}`;
                if(timeLeft % 5 === 0) saveProgress(); 
                if(timeLeft <= 0) finishQuiz();
            }, 1000);
        }

        function renderNav() {
            const grid = document.getElementById('nav-grid');
            grid.innerHTML = '';
            quizQuestions.forEach((_, i) => {
                const dot = document.createElement('div');
                dot.className = `nav-dot ${userAnswers[i] !== null ? 'attempted' : ''} ${i === currentIdx ? 'current' : ''}`;
                dot.innerText = i + 1;
                dot.onclick = () => { currentIdx = i; loadQuestion(); toggleMenu(); };
                grid.appendChild(dot);
            });
        }

        function loadQuestion() {
            const q = quizQuestions[currentIdx];
            document.getElementById('q-counter').innerText = `QUESTION ${currentIdx + 1} OF ${quizQuestions.length}`;
            document.getElementById('q-text').innerText = q.question;
            const container = document.getElementById('options-container');
            container.innerHTML = '';
            q.options.forEach((opt, i) => {
                const div = document.createElement('label');
                div.className = 'option-item';
                div.innerHTML = `<input type="radio" name="quizOpt" value="${i}" ${userAnswers[currentIdx] === i ? 'checked' : ''} onchange="saveAnswer(${i})"> <span>${opt}</span>`;
                container.appendChild(div);
            });
            document.getElementById('prevBtn').style.visibility = currentIdx === 0 ? 'hidden' : 'visible';
            document.getElementById('nextBtn').style.display = currentIdx === quizQuestions.length - 1 ? 'none' : 'block';
            document.getElementById('submitBtn').style.display = currentIdx === quizQuestions.length - 1 ? 'block' : 'none';
        }

        function saveAnswer(val) { 
            userAnswers[currentIdx] = val; 
            saveProgress(); 
        }

        function changeQuestion(step) {
            currentIdx += step;
            loadQuestion();
            window.scrollTo(0,0);
            saveProgress();
        }

        function finishQuiz() {
            if(timeLeft > 0 && !confirm("Finish and submit your answers?")) return;
            clearInterval(timerInterval);
            localStorage.removeItem('quiz_progress');
            localStorage.setItem('quiz_last_submitted', 'true');

            let score = 0;
            userAnswers.forEach((ans, i) => {
                if(ans === null) return;
                if(ans === quizQuestions[i].correct) { score += 1; } 
                else { score -= (1/3); }
            });
            const finalScore = score.toFixed(2);
            const name = document.getElementById('userName').value;
            const timeTaken = Math.floor((30 * 60 - timeLeft) / 60) + " mins";

            const formUrl = `https://docs.google.com/forms/d/e/${FORM_ID}/formResponse?${ENTRY_NAME}=${encodeURIComponent(name)}&${ENTRY_SCORE}=${finalScore}&${ENTRY_TIME}=${timeTaken}&submit=Submit`;
            fetch(formUrl, { mode: 'no-cors' });
            
            document.getElementById('quiz-screen').classList.remove('active');
            document.getElementById('final-screen').classList.add('active');
            launchConfetti();

            // SCORE IS NOW SHOWN HERE
            document.getElementById('final-msg-container').innerHTML = `
                <h2 style="margin: 0 0 20px 0; color: var(--dark);">Hi ${name}</h2>
                <p style="color: #475569; font-size: 1.1rem; line-height: 1.6; margin-bottom: 30px;">
                    Your score: <strong>${finalScore}</strong><br>
                    Your mark has been submitted.<br>
                    <strong>Ranklist will be soon available.</strong>
                </p>
                <button class="btn-next" onclick="showReview()">View Your Response</button>
            `;
        }

        function launchConfetti() {
            var duration = 5 * 1000;
            var animationEnd = Date.now() + duration;
            var interval = setInterval(function() {
                var timeLeft = animationEnd - Date.now();
                if (timeLeft <= 0) return clearInterval(interval);
                confetti({ particleCount: 50, startVelocity: 30, spread: 360, origin: { x: Math.random(), y: Math.random() - 0.2 } });
            }, 250);
        }

        function showReview() {
            document.getElementById('final-screen').classList.remove('active');
            document.getElementById('review-screen').classList.add('active');
            const list = document.getElementById('review-list');
            list.innerHTML = '';
            quizQuestions.forEach((q, i) => {
                const userAns = userAnswers[i];
                const isCorrect = userAns === q.correct;
                const isUnattempted = userAns === null;
                let badgeText = isUnattempted ? "‚ö† Unattempted" : (isCorrect ? "‚úî Correct" : "‚úñ Wrong");
                let badgeColor = isUnattempted ? "color: var(--warning); background: #fffbeb; border: 1px solid var(--warning);" : (isCorrect ? "color: var(--success); background: #dcfce7; border: 1px solid var(--success);" : "color: var(--danger); background: #fee2e2; border: 1px solid var(--danger);");

                let cardHtml = `<div class="review-card"><div class="q-header-review"><span class="q-text-review">Q${i+1}: ${q.question}</span><span class="status-badge" style="${badgeColor}">${badgeText}</span></div>`;
                q.options.forEach((opt, optIdx) => {
                    let styleClass = 'review-option' + (q.correct === optIdx ? ' review-correct' : (userAns === optIdx ? ' review-wrong' : ''));
                    cardHtml += `<div class="${styleClass}">${opt}</div>`;
                });
                cardHtml += `</div>`;
                list.innerHTML += cardHtml;
            });
            window.scrollTo(0,0);
        }
    </script>
</body>
</html>
